// PM2 Ecosystem Configuration
// Generated by Ansible - do not edit manually

module.exports = {
  apps: [{
    name: '{{ pm2_process_name }}',
    script: './index.js',
    args: 'start --config ./runner.yaml',
    cwd: '{{ runner_base_dir }}',
    interpreter: 'node',

    // Logging
    out_file: '/tmp/{{ pm2_process_name }}.log',
    error_file: '/tmp/{{ pm2_process_name }}.log',
    merge_logs: true,
    log_date_format: 'YYYY-MM-DD HH:mm:ss',

    // Process management
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '2G',

    // Graceful shutdown - set very high since jobs can run 24h
    // Actual drain is handled by SIGUSR1 maintenance mode
    kill_timeout: 300000,  // 5 minutes fallback
    wait_ready: false,
    listen_timeout: 10000,

    // Environment
    env: {
      NODE_ENV: 'production',
{% if extra_env is defined and extra_env %}
{% for key, value in extra_env.items() %}
      {{ key }}: '{{ value }}',
{% endfor %}
{% endif %}
    }
  }]
};
