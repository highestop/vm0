pre-commit:
  parallel: false
  commands:
    turbo-checks:
      root: turbo/
      # Run lint and check-types together to avoid turbo cache deadlock
      run: pnpm turbo run lint check-types --filter='...[HEAD]' --ui=stream
      glob: "turbo/**/*.{js,ts,tsx,jsx,mjs,cjs}"
    prettier:
      root: turbo/
      run: pnpm prettier --write --ignore-unknown {staged_files}
      glob: "turbo/**/*"
      stage_fixed: true
    knip:
      root: turbo/
      run: pnpm knip --cache
      glob: "turbo/**/*.{js,ts,tsx,jsx,json}"
      skip:
        - merge
        - rebase
      fail_text: "Knip found unused code. Run 'cd turbo && pnpm knip' to see details."
      timeout: 60
    check-file-size:
      run: ./scripts/check-file-size.sh {staged_files}
      glob: "**/*"
      exclude:
        - "turbo/apps/*/public/og-image.png"
        - "turbo/apps/*/public/assets/cta-ellipse.png"
        - "turbo/apps/*/public/assets/code_illustration.svg"
      fail_text: |
        File size check failed. Some staged files exceed the 1MB limit.
        Run 'git diff --cached --name-only' to see staged files.
